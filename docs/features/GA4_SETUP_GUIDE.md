# Google Analytics 4 設定指南

本指南說明如何設定 GA4 以查看 onboarding 事件追蹤的報表。

## 目錄

1. [自訂維度設定](#1-自訂維度設定)
2. [轉換事件設定](#2-轉換事件設定)
3. [漏斗分析設定](#3-漏斗分析設定)
4. [自訂報表建立](#4-自訂報表建立)
5. [即時監控設定](#5-即時監控設定)

---

## 1. 自訂維度設定

### 為什麼需要設定？
GA4 預設不會將事件參數作為維度，需要手動建立自訂維度才能在報表中使用。

### 設定步驟

**路徑**: 管理 → 資料顯示 → 自訂定義 → 建立自訂維度

建立以下自訂維度：

#### 1.1 登入/註冊方式 (method)
```
維度名稱: 登入方式
範圍: 事件
說明: 使用者的登入/註冊方式 (email/google)
事件參數: method
```

#### 1.2 Session ID (session_id)
```
維度名稱: Session ID
範圍: 事件
說明: 教練 session 的唯一識別碼
事件參數: session_id
```

#### 1.3 錯誤類型 (error_type)
```
維度名稱: 錯誤類型
範圍: 事件
說明: 上傳或處理失敗的錯誤類型
事件參數: error_type
```

#### 1.4 快速開始步驟 (step)
```
維度名稱: 快速開始步驟
範圍: 事件
說明: 使用者點擊的快速開始指南步驟編號
事件參數: step
```

### 設定後效果
- 可以在報表中按「登入方式」篩選使用者
- 可以追蹤特定 session 的完整生命週期
- 可以分析最常見的錯誤類型

---

## 2. 轉換事件設定

### 為什麼需要設定？
將關鍵事件標記為「轉換」，可以在 GA4 中更容易追蹤目標達成率。

### 設定步驟

**路徑**: 管理 → 資料顯示 → 事件 → 標記為轉換

標記以下事件為轉換：

#### 2.1 註冊完成
```
事件名稱: user_signup_complete
轉換價值: (可選) 設定每次註冊的估計價值
```

#### 2.2 首次上傳音訊
```
事件名稱: audio_upload_complete
轉換價值: (可選) 設定首次上傳的價值
篩選條件: 可設定只計算首次上傳
```

#### 2.3 首次建立 Session
```
事件名稱: session_create_complete
轉換價值: (可選)
```

#### 2.4 查看逐字稿
```
事件名稱: transcript_view
轉換價值: (可選)
```

### 設定後效果
- 在「轉換」報表中查看各轉換事件的達成率
- 計算轉換成本 (如果有付費廣告)
- 設定目標追蹤

---

## 3. 漏斗分析設定

### 設定新漏斗

**路徑**: 探索 → 空白 → 選擇「漏斗探索」範本

### 3.1 完整 Onboarding 漏斗

```
漏斗名稱: 使用者 Onboarding 流程

步驟設定:
┌─────────────────────────────────────────────┐
│ 步驟 1: 註冊完成                              │
│ 事件: user_signup_complete                  │
│                                             │
│ ↓                                           │
│                                             │
│ 步驟 2: 首次登入 Dashboard                    │
│ 事件: dashboard_first_view                  │
│                                             │
│ ↓                                           │
│                                             │
│ 步驟 3: 建立第一個 Session                    │
│ 事件: session_create_complete               │
│                                             │
│ ↓                                           │
│                                             │
│ 步驟 4: 上傳第一個錄音檔                       │
│ 事件: audio_upload_complete                 │
│                                             │
│ ↓                                           │
│                                             │
│ 步驟 5: 查看第一個逐字稿                       │
│ 事件: transcript_view                       │
└─────────────────────────────────────────────┘
```

**漏斗設定選項**:
- ✅ 開啟「開放漏斗」(允許使用者跳過步驟)
- ✅ 時間範圍: 7 天內完成
- ✅ 細分: 按「登入方式」維度

### 3.2 上傳成功率漏斗

```
漏斗名稱: 音訊上傳成功率

步驟 1: 開始上傳
事件: audio_upload_start

步驟 2: 上傳成功
事件: audio_upload_complete

失敗追蹤:
事件: audio_upload_failed
維度: error_type (分析失敗原因)
```

### 3.3 登入轉換漏斗

```
漏斗名稱: 登入到首次使用

步驟 1: 登入開始
事件: user_login_start

步驟 2: 登入成功
事件: user_login_complete

步驟 3: 查看 Dashboard
事件: dashboard_first_view

步驟 4: 點擊快速開始指南
事件: quick_start_step_click
```

---

## 4. 自訂報表建立

### 4.1 Onboarding 概覽報表

**路徑**: 探索 → 空白 → 任意形式報表

**維度**:
- 日期
- 登入方式

**指標**:
- user_signup_complete (計數)
- user_login_complete (計數)
- session_create_complete (計數)
- audio_upload_complete (計數)
- transcript_view (計數)

**視覺化**: 折線圖 (時間序列)

### 4.2 錯誤分析報表

**維度**:
- error_type (自訂維度)
- 日期

**指標**:
- audio_upload_failed (計數)
- transcript_processing_failed (計數)

**篩選條件**:
- 只顯示有錯誤的事件

**視覺化**: 長條圖

### 4.3 使用者行為路徑

**路徑**: 探索 → 選擇「路徑探索」範本

**起始點**:
- user_signup_complete 或 user_login_complete

**結束點**:
- 任何事件

**設定**:
- 顯示前 5 個最常見路徑
- 時間範圍: 30 天

### 4.4 Session 生命週期報表

**維度**:
- session_id (自訂維度)
- 事件名稱

**指標**:
- 事件計數
- 事件值

**篩選條件**:
- 事件名稱包含: session_create, audio_upload, transcript_view, transcript_delete

---

## 5. 即時監控設定

### 5.1 即時事件監控

**路徑**: 報表 → 即時

在即時報表中可以看到：
- 過去 30 分鐘的事件
- 即時使用者數量
- 即時轉換次數

**實用場景**:
- 測試新功能時即時查看事件是否正確觸發
- 監控上線後的使用者行為
- 快速發現異常流量或錯誤

### 5.2 建立自訂快訊

**路徑**: 管理 → 自訂快訊

#### 快訊 1: 上傳失敗率過高
```
快訊名稱: 上傳失敗率警告
條件:
  - audio_upload_failed 計數 > 10 (每小時)
  - 或失敗率 > 20%
通知方式: Email
收件人: 開發團隊
```

#### 快訊 2: 註冊轉換率下降
```
快訊名稱: 註冊轉換率異常
條件:
  - user_signup_complete 比前一週下降 > 30%
通知方式: Email + Slack
```

---

## 6. 預設報表範本

為方便快速查看，建立以下預設報表：

### 6.1 每日摘要報表

**指標卡片**:
```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 新註冊使用者  │ 活躍使用者    │ 新增 Session │ 上傳成功率   │
│     45      │     128     │     89      │    94.2%    │
│   ↑ 12%    │   ↑ 5%     │   ↓ 3%     │   ↑ 2%     │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

### 6.2 漏斗轉換率摘要

```
註冊 → 登入: 95% (流失 5%)
登入 → 建立 Session: 75% (流失 25%)
建立 Session → 上傳: 60% (流失 40%)
上傳 → 查看逐字稿: 85% (流失 15%)

整體轉換率: 38.5%
```

---

## 7. 常見問題

### Q1: 為什麼看不到自訂事件？
**A**:
1. 確認 GTM 容器已發布
2. 檢查事件是否正確觸發 (開發者工具 → Network → gtag)
3. GA4 資料可能有 24-48 小時延遲

### Q2: 如何測試事件是否正確？
**A**:
1. 使用 GA4 的「即時」報表
2. 使用 Chrome 擴充功能「GA Debugger」
3. 查看瀏覽器 Console 的開發模式日誌

### Q3: 自訂維度什麼時候生效？
**A**:
- 建立後立即生效
- 但只能看到建立後收集的資料
- 無法追溯歷史資料

### Q4: 轉換事件的限制？
**A**:
- GA4 免費版最多 30 個轉換事件
- 建議只標記最重要的事件

---

## 8. 進階設定 (可選)

### 8.1 事件修改

如需修改事件參數，可使用 GTM 的「事件修改」功能。

### 8.2 受眾建立

基於事件建立再行銷受眾：
- 完成註冊但未上傳的使用者
- 上傳失敗的使用者
- 高度活躍使用者

### 8.3 BigQuery 匯出 (進階)

如需進階分析，可設定匯出到 BigQuery。

---

## 9. 檢查清單

設定完成後，請確認：

- [ ] 所有自訂維度已建立並顯示資料
- [ ] 關鍵轉換事件已標記
- [ ] 至少建立 1 個漏斗分析
- [ ] 至少建立 2 個自訂報表
- [ ] 設定 1-2 個異常快訊
- [ ] 團隊成員都有 GA4 存取權限
- [ ] 已在即時報表測試事件觸發

---

## 10. 相關資源

- [GA4 官方文件](https://support.google.com/analytics/answer/9304153)
- [GTM 設定指南](https://tagmanager.google.com/)
- 專案文件: `docs/features/onboarding-improvement/README.md`
- Analytics 實作: `apps/web/lib/analytics.ts`

---

**最後更新**: 2025-10-07
**版本**: 1.0
**維護者**: Coachly 開發團隊
